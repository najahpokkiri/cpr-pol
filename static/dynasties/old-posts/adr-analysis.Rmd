---
title: 'ADR  Analysis'
date: "2020-06-15"
params:
  orig_date: "Original Publish Date: 15 June, 2020"
  update_date: !r paste("Updated on:", format(Sys.time(), '%d %B, %Y'))
output:
  html_document:
    theme: readable
    toc: TRUE
    toc_float: TRUE
    toc_depth: 5
    number_sections: false
    fig_width: 6            
editor_options: 
  chunk_output_type: inline

---



---

### Document History

`r params$orig_date`

`r params$update_date`

---




```{r set up, warning=FALSE, include=FALSE, message= FALSE, cache = FALSE}

knitr::opts_chunk$set(cache =FALSE,echo = FALSE, message=FALSE, warning = FALSE)

##fig.width = 16/2, fig.height = 9/2

library(tidyverse)
library(data.table)
library(knitr)
library(kableExtra)
library(scales)
library(gridExtra)
`%!in%` = Negate(`%in%`)

select <- dplyr::select

"/" <- function(x,y) ifelse(y==0,0,base:::"/"(x,y))
```

# 5 PC{.tabset}

```{r}

dyn_ae <- readxl::read_xlsx("D:/cpr/UP/up-dynasties/dyn_other_data/TCPD_UP_VS_16_17_RK.xlsx")


dyn_ae <- dyn_ae %>% select(5:6, 10:10,14:14)



adr_ae_12 <- read.csv("D:/cpr/UP/up-dynasties/dyn_other_data/adr/up_12_adr.csv")



adr_ae_17 <- read.csv("D:/cpr/UP/up-dynasties/dyn_other_data/adr/up_17_adr.csv")

adr_ae <- rbindlist (list(adr_ae_12, adr_ae_17), use.names = TRUE, fill= TRUE)





adr_ae <- adr_ae %>% select(-(1:9))



dyn_ae_adr <- inner_join(dyn_ae, adr_ae, by =c("Year", "Constituency_No", "Position"))

names(dyn_ae_adr) <- tolower(names(dyn_ae_adr))

dyn_ae_adr <- dyn_ae_adr %>% rename ( dyn= dynast)


# 
# 
# dyn_ge <- readxl::read_xlsx("D:/cpr/UP/up-dynasties/dyn_other_data/UP_TCPD_GE_091419 _April_21.xlsx")
# 
# 
# 
# 
# dyn_ge <-dyn_ge %>% select( 3:5,15:15)
# 
# 
# 
# adr_ge <- fread("D:/cpr/UP/up-dynasties/dyn_other_data/adr_candidatelevel.csv")
# 
# 
# adr_ge <- adr_ge %>% select(-c(2:10))
# 
# dyn_ge_adr <- inner_join(dyn_ge, adr_ge, by = c("Year" , "Constituency_No" , "Position" = "position"))
# 
# names(dyn_ge_adr) <- tolower(names(dyn_ge_adr))
# 
# 
# 
# 
# dyn_ge_adr$state_name <- NULL
# 
# 
# #dyn_ge_adr  <- dyn_ge_adr %>% select(-c(58:63,7:10, 11:13, 15:21))
# 
# dyn_ae_ge_adr <- rbindlist(list(dyn_ae_adr, dyn_ge_adr), use.names = TRUE, fill = TRUE)

dyn_ae_adr$total_assets <- as.numeric(dyn_ae_adr$total_assets )

# 
# dyn_ge_adr  <- dyn_ge_adr %>% mutate(edu = case_when(education %in% c("5th Pass","10th Pass","8th Pass") ~"10",
#                                   education == "12th Pass" ~"12",
#                                   education %in% c("Graduate","Graduate Professional") ~"14",
#                                   education == "Post Graduate" ~ "16",
#                                   education == "Doctorate" ~"18",
#                                   education %in% c("Literate","Others") ~"5",
#                                   TRUE ~ "0"
#                                   
#                                   
#                                   ))


caste_uc <- ifelse(dyn_ae_ge_adr$caste_rec%in% c("IC","UC","uc"),1,0)

caste_muslim <- as.numeric(case_when(grepl( "muslim",dyn_ae_ge_adr$caste_rec, ignore.case = TRUE) ~"1",
                   TRUE ~"0"))


caste_sc <- ifelse(dyn_ae_ge_adr$caste_rec %in% c("SC","ST"),1,0)

caste_obc<- ifelse(dyn_ae_ge_adr$caste_rec =="OBC",1,0)


dyn_ae_adr <- dyn_ae_adr %>% mutate(caste_groups = case_when(caste_rec%in% c("IC","UC","uc")~"Upper Caste",
                                               grepl( "muslim",caste_rec, ignore.case = TRUE) ~"Muslim",
                                               caste_rec =="OBC"~"OBC",
                                               caste_rec %in% c("SC","ST") ~"Dalit",
                                               TRUE ~"Others"
                                               
                                               
                                                         
                                               ))




```


## assets

```{r}

dyn_ae_adr$caste_groups <- factor(dyn_ae_adr$caste_groups, levels = c("Upper Caste","OBC"  ,"Dalit" ,"Muslim","Others" ) )


ggplot(dyn_ae_adr %>% filter(total_assets<1000000000), aes(caste_groups, total_assets))+
  geom_boxplot()+
  facet_wrap(~year)+
    scale_y_log10(
    breaks = scales::trans_breaks("log10", function(x) 10^x),
    labels = scales::trans_format("log10", scales::math_format(10^.x))
  )
  # scale_y_log10() 
  # scale_y_continuous(trans = 'log10')+
  # annotation_logticks(sides="lb")
  # scale_y_continuous(labels = unit_format(unit = "M", scale = 1e-6))




ggplot(dyn_ae_adr %>% filter(total_assets<100000000), aes(caste_groups, total_assets))+
  geom_boxplot()+
  facet_wrap(~year)+
  scale_y_continuous(labels = unit_format(unit = "M", scale = 1e-6))




```


## criminal


```{r}

dyn_ae_adr <- dyn_ae_adr %>% mutate(serious_criminal = ifelse(serious_crime>0,1,0), serious_crime_1 = ifelse(serious_crime>9,9,serious_crime))






ggplot(dyn_ae_adr %>% filter(serious_crime>1), aes(caste_groups,serious_crime_1))+
  geom_boxplot()+
   labs(subtitle = "Serious case distribution wrt caste ")+
  ylim(0,10)+
  facet_wrap(~year)
  theme_bw()
  
  
## trying a stacked chart
  
  
crime_df <- dyn_ae_adr  %>% group_by(caste_groups) %>% summarise(count = n(),
                                                    crime_1 = sum(ifelse(serious_crime>0,1,0)) /count,
                                                     crime_2 = sum(ifelse(serious_crime>1,1,0)) /count,
                                                     crime_3 = sum(ifelse(serious_crime>2,1,0)) /count) %>% 
  select(-c(2:2)) %>% 
  melt(1:1)
  

##


df_stack <- dyn_ae_adr %>% group_by(year,caste_groups) %>% summarise(total = n(), 
                                                                crime_winners = sum(ifelse(serious_crime>2 & position ==1,1,0)),
                                                                
                                                                criminal_1 = sum(serious_criminal==1), 
                                                    
                                                    
                                                    crime_3 = sum(ifelse(serious_crime>2,1,0))  ) %>% 
  group_by(year) %>% mutate(sum_total = sum(total), sum_criminal_winners = sum(crime_winners), sum_criminal_1 = sum(criminal_1), sum_criminal_2 = sum(crime_3),
                            total_pc = total/sum_total,
                            winner_pc = crime_winners/sum_criminal_winners,
                            criminal_1_pc = criminal_1/sum_criminal_1,
                            criminal_2_pc = crime_3/sum_criminal_2) %>% 
  select(1:2, 11:14) %>% 
  melt(1:2)





  ggplot(df_stack,aes(variable, value, fill = caste_groups,label = ifelse(value>.05,round(value,2),"")))+
   geom_bar(stat="identity", position = "stack")+
    geom_text(size = 2.5, position = position_stack(vjust = 0.5))+ 
    facet_wrap(~year)+
     scale_x_discrete(labels = c("All candidates","Winners","Candidates \n w/ 1 case","Candidate \n w/ 2+ case"))+
  colorspace::scale_fill_discrete_qualitative(palette= "dark3" )+
    theme_minimal()+
      
    labs(title = "Caste composition",x = "", y = "Proportion", fill = "") +
    theme(plot.margin = unit(c(.5,.5,.5,.5), "cm"))+
  theme(plot.background = element_blank(),
        axis.line.x = element_line(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "bottom"
  ) 

  
 scale_x_discrete(labels = c("All candidates","Winners","Candidates \n w/ 1 case","Candidates \n  w/ 2 case","Candidate \n w/ 2+ case"))+ggplot(df_stack, aes(variable, value, fill = caste_groups))+
  geom_bar(position = "fill",stat = "identity")+
   scale_y_continuous(labels = scales::percent_format())+
  geom_text(aes(label = paste0(value*100,"%")), 
            position = position_stack(vjust = 0.5), size = 2)
  colorspace::scale_fill_discrete_qualitative(palette ="dark3")+
  scale_x_discrete(labels = c("All candidates","Winners","Candidates \n w/ 1 case","Candidates \n  w/ 2 case","Candidate \n w/ 2+ case"))+
  labs(x = "", y = "Proportion of caste groups ", subtitle = "Caste composition")+
     theme_minimal()+
      
    labs(title = "Caste composition among families wrt success  ",x = "", y = "Proportion", fill = "") +
    theme(plot.margin = unit(c(.5,.5,.5,.5), "cm"))+
  theme(plot.background = element_blank(),
        axis.line.x = element_line(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.text.y = element_blank()
  ) 
  
  


```





```{r read main file}

dyn <- read.csv("D:/cpr/UP/up-dynasties/dyn_other_data/dyn_ae_ge.csv")

## family type



dyn  <- dyn %>% mutate(id = paste0(family_id, relative_id, rel_id_rep))

dyn <- dyn %>%group_by(family_id)%>% mutate(n_pre_08 = n_distinct(id[year<= 2007]), n_post_08 = n_distinct(id[year>2007]))






dyn <- dyn %>% mutate(success_cat = case_when(n_pre_08 >=2 & n_post_08==0 & dyn_cum_2 ==1 ~"Declining",
                                                                  n_pre_08>=2 & n_post_08 >0 & dyn_cum_2==1 ~"Stable",
                                                                  n_pre_08 <=1 & n_post_08 >=1&dyn_cum_2 ==1 ~"Rising",
                                             TRUE~"OTHERS"))






```

```{r adr}

adr <- read.csv("D:/cpr/UP/up-dynasties/dyn_other_data/adr_candidatelevel.csv", stringsAsFactors = FALSE)

names(adr)[1] <- "position"

names(adr) <- tolower(names(adr))

adr <- adr %>% dplyr::select( -constituency_id,-state,-         assembly_no,-              
 month,-              poll_no,-           
 delimid,-            position,-          
candidate,-          sex,-               
party,-              votes,-             
 candidate_type,-     valid_votes,-       
 electors,-           constituency_name,- 
 constituency_type,-  sub_region,-        
 n_cand,-             turnout_percentage,-
 vote_share_percentage,-     deposit_lost,-      
margin,-             margin_percentage,- 

enop,-              
 pid,-                max_poll_no,-       
 last_poll,-          contested,-         
 last_party,-         last_constituency_name,-                     
same_constituency,-  same_party,-        
 no_terms,-           turncoat,-          
incumbent,-          recontest   )

adr <- adr %>% filter(position_tcpd %in% c(1,2))

adr <- adr %>% rename( position = position_tcpd)

#uniqueN(adr$position)



# dim(adr)
# 
# adr %>% glimpse()
# 
# unique(adr$year)
# 
# summary(adr)
# names(adr)


```


```{r merging it with dyn -adr}


dyn_adr <- merge(dyn,adr, by = c("year", "constituency_no", "position"))


names(dyn_adr) <- make.unique(names(dyn_adr))

dyn_adr$total_assets <- as.numeric(dyn_adr$total_assets)

dyn_adr$fam_exp_cum_cat <- factor(dyn_adr$fam_exp_cum_cat, levels=c("[0,1)","[1,6)","[6,11)","[11,21)","[21,Inf]"))


#dyn_adr$year <- factor(dyn_adr$year, levels = c("2009", "2012","2014","2017","2019"))

dyn_adr$fam_rel_id_uniq <-  paste(dyn_adr$family_id, dyn_adr$rel_id_uniq,sep = "")

dyn_adr$dyn_cum_2_text <- ifelse(dyn_adr$dyn_cum_2 ==0, "Non-family","Family")

dyn_adr_ge <- dyn_adr %>% filter(election_type == "GE")

dyn_adr_ae <- dyn_adr %>% filter(election_type == "AE")
```


```{r setting the uniq ones}

dyn_adr_uniq <- dyn_adr %>% group_by(family_id) %>% filter(year == max(year)) %>% distinct(family_id, .keep_all = TRUE)

```





# ADR Analysis

## Assets {.tabset}



```{r uniq}



dyn_adr_uniq_ind <- dyn_adr %>% group_by(fam_rel_id_uniq ) %>% filter(year == max(year)) %>% 
  distinct(fam_rel_id_uniq, .keep_all = T)

dyn_adr_uniq_ind_el <- dyn_adr %>% group_by(election_type, fam_rel_id_uniq ) %>% filter(year == max(year)) %>% 
  distinct(fam_rel_id_uniq, .keep_all = T)
```



### Family v/s non-family


```{r all assets}

dyn_adr_uniq_ind_el_ass <- dyn_adr_uniq_ind_el %>% filter(total_assets< 500000000)

ylim1 = boxplot.stats(dyn_adr_uniq_ind_el_ass$total_assets)$stats[c(1, 5)]

ggplot(dyn_adr_uniq_ind_el_ass, aes(factor(dyn_cum_2),total_assets))+
  geom_boxplot(outlier.shape = NA)+
  facet_grid(~ election_type )+
  coord_cartesian(ylim = ylim1*2.3)+
   scale_x_discrete(labels=(c("Non Family","Family")))+
  scale_y_continuous(label = label_number_si())+
  theme_minimal()+
   theme(plot.margin = unit(c(.5,.5,.5,.5), "cm"))+
   stat_summary(fun=mean, geom="point", shape=20, size=3, color="orange", fill="orange")+
    theme(legend.position="none") +
    scale_fill_brewer(palette="Set1")+
  labs(title = "Total assets wrt family type ",subtitle = " Assembly and General elections", x = "", y = "Assets" )+
  theme(plot.background = element_blank(),
        plot.title = element_text(family = "serif",hjust = 0.5, size = 20), 
        plot.subtitle = element_text(hjust = 0.5, size = 15,
                                     margin = margin(t = 0, r = 0, b = 20, l = 0)),
        text = element_text(color = "gray20",family = "serif"),
        axis.text.x = element_text(
                                   hjust = .5, vjust = 0),
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        axis.text = element_text(face = "italic", size = 10),
        axis.title = element_text(vjust = -1, size = 15),        
        axis.ticks = element_blank(),
        panel.grid.major.x = element_blank(),
  ) 

```



### Stable v/s rising {.tabset}

#### AE {.tabset}

##### Average


```{r}

dyn_adr %>% filter(election_type=="AE" & dyn_cum_2 ==1) %>% group_by(success_cat) %>% summarise(obs = n(),total_assets = mean(total_assets, trim = .05), movable_assets = mean(total_movable_assets_totals, trim = .05), immovable_assets= mean(total_immovable_assets_totals, trim= .05))%>% kable() %>% kable_styling(full_width = F)


```


#####  Proportion

```{r}

dyn_adr %>% filter(election_type=="AE" & dyn_cum_2 ==1) %>% group_by(success_cat) %>% 
summarise(movable =sum(total_movable_assets_totals)/sum(total_assets),  immovable =sum(total_immovable_assets_totals)/sum(total_assets))%>% kable(digits = 2) %>% kable_styling(full_width = F)

```

##### Growth 

```{r}
adr_12 <- dyn_adr %>% filter(election_type=="AE" & dyn_cum_2 ==1 & year ==2012) %>% select(family_id, year,tot_12 = total_assets, immov_12=total_immovable_assets_totals, mov_12= total_movable_assets_totals) %>% distinct(family_id, .keep_all = TRUE)

adr_17 <- dyn_adr %>% filter(election_type=="AE" & dyn_cum_2 ==1 & year ==2017)  %>% select(family_id, year,tot_17 = total_assets, immov_17 = total_immovable_assets_totals, mov_17 =total_movable_assets_totals, success_cat) %>% distinct(family_id, .keep_all = TRUE)



ass_12_17 <- inner_join(adr_17,adr_12, by = "family_id") 

ass_rates <- ass_12_17  %>% mutate(tot_change = (tot_17-tot_12)/tot_12 *100, mov_change = (mov_17-mov_12)/mov_12 *100, immov_change = (immov_17-immov_12)/immov_12 *100) 


ass_12_17  %>% mutate(tot_change = (tot_17-tot_12)/tot_12 *100, mov_change = (mov_17-mov_12)/mov_12 *100, immov_change = (immov_17-immov_12)/immov_12 *100) %>% group_by(success_cat) %>% summarise(obs = n(),
                                                                                                                                                                                                    pc_change_tot = mean(tot_change), pc_change_mov = mean(mov_change), pct_change_immov = mean(immov_change, na.rm = TRUE)) %>% kable() %>% kable_styling(full_width = F)




```


---

###### Plots



```{r}

rates <- ass_rates %>%select(success_cat, mov_change, immov_change, tot_change) %>% pivot_longer(cols =2:4 )


ggplot(rates %>% filter(value<600), aes(success_cat,value))+
  geom_boxplot()+
  facet_wrap(~name)+
  theme_minimal()+
  labs(title = "Percentage growth of  assets ", subtitle = "AE 2012-17")+
  theme(legend.position = "none")





# 
# cowplot::plot_grid(tot, mov, immov)

```

---



#### GE {.tabset}

##### Average

```{r}
dyn_adr %>% filter(election_type=="GE" & dyn_cum_2 ==1) %>% group_by(success_cat) %>% summarise(obs = n(),total_assets = mean(total_assets, trim = .05), movable_assets = mean(total_movable_assets_totals, trim = .05), immovable_assets= mean(total_immovable_assets_totals, trim= .05))%>% kable() %>% kable_styling(full_width = F)

```

#####  Proportion

```{r}

dyn_adr %>% filter(election_type=="GE" & dyn_cum_2 ==1) %>% group_by(success_cat) %>% 
summarise(movable =sum(total_movable_assets_totals)/sum(total_assets),  immovable =sum(total_immovable_assets_totals)/sum(total_assets))%>% kable(digits = 2) %>% kable_styling(full_width = F)

```







###  Experience v/s assets



```{r}
# library(extrafont)
# font_import()
# loadfonts(device = "win")
dyn_adr_ass <- dyn_adr %>%  filter(total_assets< 500000000)

ylim1 = boxplot.stats(dyn_adr_ass$total_assets)$stats[c(1, 5)]


ggplot(dyn_adr_ass, aes(fam_exp_cum_cat, total_assets))+
  geom_boxplot(outlier.shape = NA)+
  #facet_grid(~ dyn_cum_2_text)+
  coord_cartesian(ylim = ylim1*1)+
   scale_x_discrete(labels = c("0","1-5","6-10","11-20", "21+"))+
  scale_y_continuous(label = label_number_si())+
  theme_minimal()+
   theme(plot.margin = unit(c(.5,.5,.5,.5), "cm"))+
   stat_summary(fun=mean, geom="point", shape=20, size=3, color="orange", fill="orange")+
    theme(legend.position="none") +
    scale_fill_brewer(palette="Set1")+
  labs(title = "Total assets wrt political experience ", x = "Politcal Experience \n (years)", y = "Assets" )+
  theme(plot.background = element_blank(),
        plot.title = element_text(family = "serif",hjust = 0.5, size = 20), 
        plot.subtitle = element_text(hjust = 0.5, size = 15,
                                     margin = margin(t = 0, r = 0, b = 20, l = 0)),
        text = element_text(color = "gray20",family = "serif"),
        axis.text.x = element_text(
                                   hjust = .5, vjust = 0),
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        axis.text = element_text(face = "italic", size = 10),
        axis.title = element_text(vjust = -1, size = 15),        
        axis.ticks = element_blank(),
        # panel.grid.major.x = element_blank(),
        panel.grid.major = element_line(color = "gray50", size = .3),
        panel.grid.minor = element_blank(),
        panel.grid.major.x = element_blank(),
  ) 




```

#### exp v/s caste v/s assets


```{r}

exp_ass <- dyn_adr%>% filter(dyn_cum_2 ==1)%>% group_by(caste_groups,fam_exp_cum_cat ) %>% summarise(mean_assets = mean(total_assets, trim = .1, na.rm = TRUE)) %>% filter(caste_groups != "Others")
                                                                                      
  ggplot(exp_ass,aes(factor(fam_exp_cum_cat), mean_assets, color =caste_groups , group = caste_groups)) +
  geom_line()+
  geom_point()+
  #facet_grid(rows = vars(election_type) )+
    theme_minimal()+
    theme(plot.margin = unit(c(.5,.5,.5,.5), "cm"))+
    #theme(strip.text.y = element_text(size = 10, colour = "orange", angle = 0))+
    scale_x_discrete(labels = c("0","1-5","6-10","11-20", "21+"))+
    scale_y_continuous(label = label_number_si())+
    labs(title = "Average assets distribution wrt politcal experience ", x = "Politcal Experience \n (in years) ", y = "Assets" )+
  theme(legend.position = "top",
        plot.background = element_blank(),
        plot.title = element_text(family = "serif",hjust = 0.5, size = 20), 
        plot.subtitle = element_text(hjust = 0.5, size = 15,
                                     ),
        text = element_text(color = "gray20", family = "serif"),
        axis.text.x = element_text(
                                   hjust = .5, vjust = 0),
        legend.title = element_blank(),
        legend.text = element_text(size = 12),
        axis.text = element_text(face = "italic", size = 10),
        axis.title.x = element_text(vjust = -.5,hjust = .5, size = 14,
                                  margin = unit(c(3, 0, 0, 0), "mm")),
        axis.title.y = element_text(vjust = -.5,hjust = .5, size = 14,
                                  margin = unit(c(0, 3, 0, 0), "mm")),
        axis.ticks = element_blank(),
        ) 
  
```






### GE{.tabset}


#### Total assets

```{r ge all assets year break up}

ylim1 = boxplot.stats(dyn_adr_ge$total_assets)$stats[c(1, 5)]

ggplot(dyn_adr_ge, aes(factor(dyn_cum_2),total_assets))+
  geom_boxplot(outlier.shape = NA)+
  facet_grid(~ year)+
  coord_cartesian(ylim = ylim1*2)+
   scale_x_discrete(labels=(c("Non Family","Family")))+
  scale_y_continuous(label = label_number_si())+
  theme_minimal()+
  theme(plot.margin = unit(c(.5,.5,.5,.5), "cm"))+
  labs(title = "Total assets wrt family type ",subtitle = " General elction", x = "", y = "Assets" )+
  theme(plot.background = element_blank(),
        plot.title = element_text(family = "serif",hjust = 0.5, size = 20), 
        plot.subtitle = element_text(hjust = 0.5, size = 15,
                                     margin = margin(t = 0, r = 0, b = 20, l = 0)),
        text = element_text(color = "gray20",family = "serif"),
        axis.text.x = element_text( 
                                   hjust = .5, vjust = 0),
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        axis.text = element_text(face = "italic", size = 10),
        axis.title = element_text(vjust = -1, size = 15),        
        axis.ticks = element_blank()
  ) 
```



#### Growth{.tabset}


##### 2009-19


```{r}
adr_09 <- dyn_adr %>% filter(election_type=="GE" & year ==2009) %>% select(family_id, year,tot_09 = total_assets, immov_09=total_immovable_assets_totals, mov_09= total_movable_assets_totals) %>% distinct(family_id, .keep_all = TRUE)

adr_19 <- dyn_adr %>% filter(election_type=="GE"  & year ==2019)  %>% select(family_id, year,tot_19 = total_assets, immov_19 = total_immovable_assets_totals, mov_19 =total_movable_assets_totals, dyn_cum_2) %>% distinct(family_id, .keep_all = TRUE)



ass_09_19 <- inner_join(adr_09,adr_19, by = "family_id")


ass_rates <- ass_09_19 %>% mutate(tot_change = (tot_19-tot_09)/tot_09 *100, mov_change = (mov_19-mov_09)/mov_09 *100, immov_change = (immov_19-immov_09)/immov_09 *100) %>% group_by(dyn_cum_2)

ass_09_19 %>% mutate(tot_change = (tot_19-tot_09)/tot_09 *100, mov_change = (mov_19-mov_09)/mov_09 *100, immov_change = (immov_19-immov_09)/immov_09 *100) %>% group_by(dyn_cum_2) %>% summarise(obs = n(),
                                                                                                                                                                                                    pc_change_tot = mean(tot_change, trim = .025), pc_change_mov = mean(mov_change, trim = .025), pct_change_immov = mean(immov_change, trim = .025, na.rm = TRUE))%>% kable() %>% kable_styling(full_width = F)



#table(cut(ass_rates$immov_change, breaks = c(-Inf, 0,100,30,500,1000,2000, Inf)))
```

----

```{r}


rates <- ass_rates %>%select(dyn_cum_2, mov_change, immov_change, tot_change) %>% pivot_longer(cols =2:4 )


ggplot(rates %>% filter(value<600), aes(factor(dyn_cum_2),value))+
  geom_boxplot()+
  facet_wrap(~name)+
  theme_minimal()+
  scale_x_discrete(labels = c("non-family", "family"))+
  labs(title = "Percentage growth of  assets ", subtitle = "GE 2009:19", x = "", y = "% growth")+
  theme(legend.position = "none")




```

##### 2014-19


```{r}
adr_14 <- dyn_adr %>% filter(election_type=="GE" & year ==2014) %>% select(family_id, year,tot_14 = total_assets, immov_14=total_immovable_assets_totals, mov_14= total_movable_assets_totals) %>% distinct(family_id, .keep_all = TRUE)

adr_19 <- dyn_adr %>% filter(election_type=="GE"  & year ==2019)  %>% select(family_id, year,tot_19 = total_assets, immov_19 = total_immovable_assets_totals, mov_19 =total_movable_assets_totals, dyn_cum_2) %>% distinct(family_id, .keep_all = TRUE)



ass_14_19 <- inner_join(adr_14,adr_19, by = "family_id")


ass_rates <- ass_14_19 %>% mutate(tot_change = (tot_19-tot_14)/tot_14 *100, mov_change = (mov_19-mov_14)/mov_14 *100, immov_change = (immov_19-immov_14)/immov_14 *100) %>% group_by(dyn_cum_2)

ass_14_19 %>% mutate(tot_change = (tot_19-tot_14)/tot_14 *100, mov_change = (mov_19-mov_14)/mov_14 *100, immov_change = (immov_19-immov_14)/immov_14 *100) %>% group_by(dyn_cum_2) %>% summarise(obs = n(),
                                                                                                                                                                                                    pc_change_tot = mean(tot_change, trim = .025), pc_change_mov = mean(mov_change, trim = .025), pct_change_immov = mean(immov_change, trim = .025, na.rm = TRUE)) %>% kable() %>% kable_styling(full_width = F)



#table(cut(ass_rates$immov_change, breaks = c(-Inf, 0,100,30,500,1000,2000, Inf)))
```

----

```{r}


rates <- ass_rates %>%select(dyn_cum_2, mov_change, immov_change, tot_change) %>% pivot_longer(cols =2:4 )


ggplot(rates %>% filter(value<600), aes(factor(dyn_cum_2),value))+
  geom_boxplot()+
  facet_wrap(~name)+
  theme_minimal()+
  scale_x_discrete(labels = c("non-family", "family"))+
  labs(title = "Percentage growth of  assets ", subtitle = "GE 2014-19", x = "", y = "% growth")+
  theme(legend.position = "none")

```


<!-- ##### Total Asset growth -->

<!-- ```{r GE Asset growth} -->

<!-- #dyn_adr_ge$year <- factor(dyn_adr$year, levels = c("2009", "2012","2014","2017","2019")) -->

<!-- dyn_adr_ge_r <- dyn_adr_ge %>% group_by(fam_rel_id_uniq) %>% mutate(count_pid = n())  %>% filter(count_pid > 1) -->

<!-- ge_gr <- dyn_adr_ge_r %>%  group_by(dyn_cum_2_text,year) %>% summarise(mean_assets = mean(total_assets, trim =.1) ) -->

<!--  ggplot(ge_gr,aes(factor(year, levels = c("2009", "2014","2019")), mean_assets,color = factor(dyn_cum_2_text), group = factor(dyn_cum_2_text)))+ -->
<!--   geom_line()+ -->
<!--   geom_point()+ -->
<!--     theme_minimal()+ -->
<!--     theme(plot.margin = unit(c(.5,.5,.5,.5), "cm"))+ -->
<!--     scale_y_continuous(label = label_number_si())+ -->
<!--     labs(title = "Average asset growth over years", subtitle = "General election", x = "Year", y = "Assets" )+ -->
<!--   theme(legend.position = "top", -->
<!--         plot.background = element_blank(), -->
<!--         plot.title = element_text(family = "serif",hjust = 0.5, size = 20),  -->
<!--         plot.subtitle = element_text(hjust = 0.5, size = 15, -->
<!--                                      ), -->
<!--         text = element_text(color = "gray20", family = "serif"), -->
<!--         axis.text.x = element_text( -->
<!--                                    hjust = .5, vjust = 0), -->
<!--         legend.title = element_blank(), -->
<!--         legend.text = element_text(size = 15), -->
<!--         axis.text = element_text(face = "italic", size = 10), -->
<!--         axis.title.x = element_text(vjust = -.5,hjust = .5, size = 14, -->
<!--                                   margin = unit(c(3, 0, 0, 0), "mm")), -->
<!--         axis.title.y = element_text(vjust = -.5,hjust = .5, size = 14, -->
<!--                                   margin = unit(c(0, 3, 0, 0), "mm")), -->
<!--         axis.ticks = element_blank(), -->
<!--         ) -->



<!-- ``` -->





<!-- ##### Movable assets -->

<!-- ```{r ge movable assets} -->
<!-- dyn_adr_ge_r <- dyn_adr_ge %>% group_by(fam_rel_id_uniq) %>% mutate(count_pid = n())  %>% filter(count_pid > 2) -->

<!-- ge_gr <- dyn_adr_ge_r %>%  group_by(dyn_cum_2_text,year) %>% summarise(mean_mov_assets = mean(total_movable_assets_totals, trim =.1) ) -->

<!--  ggplot(ge_gr,aes(factor(year, levels = c("2009", "2014","2019")), mean_mov_assets,color = factor(dyn_cum_2_text), group = factor(dyn_cum_2_text)))+ -->
<!--   geom_line()+ -->
<!--   geom_point()+ -->
<!--     theme_minimal()+ -->
<!--     theme(plot.margin = unit(c(.5,.5,.5,.5), "cm"))+ -->
<!--     scale_y_continuous(label = label_number_si())+ -->
<!--     labs(title = "Average movable asset growth over years", subtitle = "General election", x = "Year", y = "Assets" )+ -->
<!--   theme(legend.position = "top", -->
<!--         plot.background = element_blank(), -->
<!--         plot.title = element_text(family = "serif",hjust = 0.5, size = 20),  -->
<!--         plot.subtitle = element_text(hjust = 0.5, size = 15, -->
<!--                                      ), -->
<!--         text = element_text(color = "gray20", family = "serif"), -->
<!--         axis.text.x = element_text( -->
<!--                                    hjust = .5, vjust = 0), -->
<!--         legend.title = element_blank(), -->
<!--         legend.text = element_text(size = 15), -->
<!--         axis.text = element_text(face = "italic", size = 10), -->
<!--         axis.title.x = element_text(vjust = -.5,hjust = .5, size = 14, -->
<!--                                   margin = unit(c(3, 0, 0, 0), "mm")), -->
<!--         axis.title.y = element_text(vjust = -.5,hjust = .5, size = 14, -->
<!--                                   margin = unit(c(0, 3, 0, 0), "mm")), -->
<!--         axis.ticks = element_blank(), -->
<!--         ) -->
<!-- ``` -->


<!-- ##### Immovable assets -->

<!-- ```{r ge immovable assets, fig.height=6, fig.width=8} -->
<!-- dyn_adr_ge_r <- dyn_adr_ge %>% group_by(fam_rel_id_uniq) %>% mutate(count_pid = n())  %>% filter(count_pid > 2) -->

<!-- ge_gr <- dyn_adr_ge_r %>%  group_by(dyn_cum_2_text,year) %>% summarise(mean_immov_assets = mean(total_immovable_assets_totals, trim =.1) ) -->

<!--  ggplot(ge_gr,aes(factor(year, levels = c("2009", "2014","2019")), mean_immov_assets,color = factor(dyn_cum_2_text), group = factor(dyn_cum_2_text)))+ -->
<!--   geom_line()+ -->
<!--   geom_point()+ -->
<!--     theme_minimal()+ -->
<!--     theme(plot.margin = unit(c(.5,.5,.5,.5), "cm"))+ -->
<!--     scale_y_continuous(label = label_number_si())+ -->
<!--     labs(title = "Average immovable asset growth over years", subtitle = "General election", x = "Year", y = "Assets" )+ -->
<!--   theme(legend.position = "top", -->
<!--         plot.background = element_blank(), -->
<!--         plot.title = element_text(family = "serif",hjust = 0.5, size = 20),  -->
<!--         plot.subtitle = element_text(hjust = 0.5, size = 15, -->
<!--                                      ), -->
<!--         text = element_text(color = "gray20", family = "serif"), -->
<!--         axis.text.x = element_text( -->
<!--                                    hjust = .5, vjust = 0), -->
<!--         legend.title = element_blank(), -->
<!--         legend.text = element_text(size = 15), -->
<!--         axis.text = element_text(face = "italic", size = 10), -->
<!--         axis.title.x = element_text(vjust = -.5,hjust = .5, size = 14, -->
<!--                                   margin = unit(c(3, 0, 0, 0), "mm")), -->
<!--         axis.title.y = element_text(vjust = -.5,hjust = .5, size = 14, -->
<!--                                   margin = unit(c(0, 3, 0, 0), "mm")), -->
<!--         axis.ticks = element_blank(), -->
<!--         ) -->


<!-- #plot_grid(ge_ass_1, ge_ass_2, ge_ass_3) -->
<!-- ``` -->


### AE {.tabset}

#### Total assets

```{r}

ylim1 = boxplot.stats(dyn_adr_ae$total_assets)$stats[c(1, 5)]

ggplot(dyn_adr_ae, aes(factor(dyn_cum_2),total_assets))+
  geom_boxplot(outlier.shape = NA)+
  facet_grid(~ year)+
  coord_cartesian(ylim = ylim1*2)+
   scale_x_discrete(labels=(c("Non Family","Family")))+
  scale_y_continuous(label = label_number_si())+
  theme_minimal()+
  theme(plot.margin = unit(c(.5,.5,.5,.5), "cm"))+
  labs(title = "Total assets wrt family type ",subtitle = "Assembly elction", x = "", y = "Assets" )+
  theme(plot.background = element_blank(),
        plot.title = element_text(family = "serif",hjust = 0.5, size = 20), 
        plot.subtitle = element_text(hjust = 0.5, size = 15,
                                     margin = margin(t = 0, r = 0, b = 20, l = 0)),
        text = element_text(color = "gray20",family = "serif"),
        axis.text.x = element_text( 
                                   hjust = .5, vjust = 0),
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        axis.text = element_text(face = "italic", size = 10),
        axis.title = element_text(vjust = -1, size = 15),        
        axis.ticks = element_blank()
  ) 



```


#### Asset Growth {.tabset}





```{r}
adr_12 <- dyn_adr %>% filter(election_type=="AE" & year ==2012) %>% select(family_id, year,tot_12 = total_assets, immov_12=total_immovable_assets_totals, mov_12= total_movable_assets_totals) %>% distinct(family_id, .keep_all = TRUE)

adr_17 <- dyn_adr %>% filter(election_type=="AE" & year ==2017)  %>% select(family_id, year,tot_17 = total_assets, immov_17 = total_immovable_assets_totals, mov_17 =total_movable_assets_totals, dyn_cum_2) %>% distinct(family_id, .keep_all = TRUE)



ass_12_17 <- inner_join(adr_17,adr_12, by = "family_id") 

ass_rates <- ass_12_17  %>% mutate(tot_change = (tot_17-tot_12)/tot_12 *100, mov_change = (mov_17-mov_12)/mov_12 *100, immov_change = (immov_17-immov_12)/immov_12 *100) 


ass_12_17  %>% mutate(tot_change = (tot_17-tot_12)/tot_12 *100, mov_change = (mov_17-mov_12)/mov_12 *100, immov_change = (immov_17-immov_12)/immov_12 *100) %>% group_by(dyn_cum_2) %>% summarise(obs = n(),
                                                                                                                                                                                                    pc_change_tot = mean(tot_change, trim = .025,na.rm =TRUE), pc_change_mov = mean(mov_change,trim = .025, na.rm = TRUE), pct_change_immov = mean(immov_change,trim = .025, na.rm = TRUE)) %>% kable() %>% kable_styling(full_width = F)




```

---


```{r}

rates <- ass_rates %>%select(dyn_cum_2, mov_change, immov_change, tot_change) %>% pivot_longer(cols =2:4 )


ggplot(rates %>% filter(value<600), aes(factor(dyn_cum_2),value))+
  geom_boxplot()+
  facet_wrap(~name)+
  theme_minimal()+
  scale_x_discrete(labels = c("non-family", "family"))+
  labs(title = "Percentage growth of  assets ", subtitle = "AE 20012:17", x = "", y = "% growth")+
  theme(legend.position = "none")



```


<!-- ```{r AE Asset growth} -->

<!-- dyn_adr_ae_r <- dyn_adr_ae %>% group_by(fam_rel_id_uniq) %>% mutate(count_pid = n())  %>% filter(count_pid > 1) -->

<!-- ae_gr <- dyn_adr_ae_r %>% group_by(dyn_cum_2_text,year) %>% summarise(mean_assets = mean(total_assets, trim = .1))  -->

<!-- ggplot(ae_gr,aes(factor(year, levels = c( "2012","2017")), mean_assets,color = factor(dyn_cum_2_text), group = factor(dyn_cum_2_text)))+ -->
<!--   geom_line()+ -->
<!--   geom_point()+ -->
<!--     theme_minimal()+ -->
<!--     theme(plot.margin = unit(c(.5,.5,.5,.5), "cm"))+ -->
<!--     scale_y_continuous(label = label_number_si())+ -->
<!--     labs(title = "Average asset growth over years", subtitle = "Assembly election", x = "Year", y = "Assets" )+ -->
<!--   theme(legend.position = "top", -->
<!--         plot.background = element_blank(), -->
<!--         plot.title = element_text(family = "serif",hjust = 0.5, size = 20),  -->
<!--         plot.subtitle = element_text(hjust = 0.5, size = 15, -->
<!--                                      ), -->
<!--         text = element_text(color = "gray20", family = "serif"), -->
<!--         axis.text.x = element_text( -->
<!--                                    hjust = .5, vjust = 0), -->
<!--         legend.title = element_blank(), -->
<!--         legend.text = element_text(size = 15), -->
<!--         axis.text = element_text(face = "italic", size = 10), -->
<!--         axis.title.x = element_text(vjust = -.5,hjust = .5, size = 14, -->
<!--                                   margin = unit(c(3, 0, 0, 0), "mm")), -->
<!--         axis.title.y = element_text(vjust = -.5,hjust = .5, size = 14, -->
<!--                                   margin = unit(c(0, 3, 0, 0), "mm")), -->
<!--         axis.ticks = element_blank(), -->
<!--         ) -->



<!-- ``` -->




<!-- ##### Movable assets -->


<!-- ```{r ae movable assets} -->
<!-- dyn_adr_ae_r <- dyn_adr_ae %>% group_by(fam_rel_id_uniq) %>% mutate(count_pid = n())  %>% filter(count_pid > 2) -->

<!-- ae_gr <- dyn_adr_ae_r %>%  group_by(dyn_cum_2_text,year) %>% summarise(mean_mov_assets = mean(total_movable_assets_totals, trim =.1) ) -->

<!-- ggplot(ae_gr,aes(factor(year, levels = c("2012","2017")), mean_mov_assets,color = factor(dyn_cum_2_text), group = factor(dyn_cum_2_text)))+ -->
<!--   geom_line()+ -->
<!--   geom_point()+ -->
<!--   theme_minimal()+ -->
<!--   theme(plot.margin = unit(c(.5,.5,.5,.5), "cm"))+ -->
<!--   scale_y_continuous(label = label_number_si())+ -->
<!--   labs(title = "Average movable asset growth over years", subtitle = "Assembly election", x = "Year", y = "Assets" )+ -->
<!--   theme(legend.position = "top", -->
<!--         plot.background = element_blank(), -->
<!--         plot.title = element_text(family = "serif",hjust = 0.5, size = 20),  -->
<!--         plot.subtitle = element_text(hjust = 0.5, size = 15, -->
<!--         ), -->
<!--         text = element_text(color = "gray20", family = "serif"), -->
<!--         axis.text.x = element_text( -->
<!--           hjust = .5, vjust = 0), -->
<!--         legend.title = element_blank(), -->
<!--         legend.text = element_text(size = 15), -->
<!--         axis.text = element_text(face = "italic", size = 10), -->
<!--         axis.title.x = element_text(vjust = -.5,hjust = .5, size = 14, -->
<!--                                     margin = unit(c(3, 0, 0, 0), "mm")), -->
<!--         axis.title.y = element_text(vjust = -.5,hjust = .5, size = 14, -->
<!--                                     margin = unit(c(0, 3, 0, 0), "mm")), -->
<!--         axis.ticks = element_blank(), -->
<!--   ) -->
<!-- ``` -->


<!-- ##### Immovable assets -->

<!-- ```{r ae immovable assets} -->
<!-- dyn_adr_ae_r <- dyn_adr_ae %>% group_by(fam_rel_id_uniq) %>% mutate(count_pid = n())  %>% filter(count_pid > 2) -->

<!-- ae_gr <- dyn_adr_ae_r %>%  group_by(dyn_cum_2_text,year) %>% summarise(mean_immov_assets = mean(total_immovable_assets_totals, trim =.1) ) -->

<!-- ggplot(ae_gr,aes(factor(year, levels = c("2012","2017")), mean_immov_assets,color = factor(dyn_cum_2_text), group = factor(dyn_cum_2_text)))+ -->
<!--   geom_line()+ -->
<!--   geom_point()+ -->
<!--   theme_minimal()+ -->
<!--   theme(plot.margin = unit(c(.5,.5,.5,.5), "cm"))+ -->
<!--   scale_y_continuous(label = label_number_si())+ -->
<!--   labs(title = "Average immmovable asset growth over years", subtitle = "Assembly election", x = "Year", y = "Assets" )+ -->
<!--   theme(legend.position = "top", -->
<!--         plot.background = element_blank(), -->
<!--         plot.title = element_text(family = "serif",hjust = 0.5, size = 20),  -->
<!--         plot.subtitle = element_text(hjust = 0.5, size = 15, -->
<!--         ), -->
<!--         text = element_text(color = "gray20", family = "serif"), -->
<!--         axis.text.x = element_text( -->
<!--           hjust = .5, vjust = 0), -->
<!--         legend.title = element_blank(), -->
<!--         legend.text = element_text(size = 15), -->
<!--         axis.text = element_text(face = "italic", size = 10), -->
<!--         axis.title.x = element_text(vjust = -.5,hjust = .5, size = 14, -->
<!--                                     margin = unit(c(3, 0, 0, 0), "mm")), -->
<!--         axis.title.y = element_text(vjust = -.5,hjust = .5, size = 14, -->
<!--                                     margin = unit(c(0, 3, 0, 0), "mm")), -->
<!--         axis.ticks = element_blank(), -->
<!--   ) -->
<!-- ``` -->

### Assets v/s caste


```{r}

dyn_adr %>% group_by(caste_groups, dyn_cum_2_text) %>% summarise(mean_assets =mean(total_assets, trim = .1)) %>% filter(caste_groups !="Others") %>% 
  ggplot(aes(x =reorder(caste_groups, - mean_assets), y = mean_assets, fill= dyn_cum_2_text))+
  geom_bar(stat = "identity", position = "dodge")+
  theme_minimal()+
  scale_y_continuous(label = label_number_si())+
  scale_fill_manual (values = c("#468189", "#9DBEBB"))+
  theme(plot.margin = unit(c(.5,.5,.5,.5), "cm"))+
  labs(title = "Total assets wrt caste groups ", x = "Caste groups", y = "Assets" )+
  theme(legend.position = "top",
        plot.background = element_blank(),
        plot.title = element_text(family = "serif",hjust = 0.5, size = 20), 
        plot.subtitle = element_text(hjust = 0.5, size = 15,
                                     margin = margin(t = 0, r = 0, b = 20, l = 0)),
        text = element_text(color = "gray20",family = "serif"),
        axis.text.x = element_text( 
                                   hjust = .5, vjust = 0),
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        axis.text = element_text(face = "italic", size = 10),
        axis.title = element_text(vjust = -1, size = 15),        
        axis.ticks = element_blank(),
        panel.grid.major = element_line(color = "gray50", size = .5),
        panel.grid.minor = element_blank(),
        panel.grid.major.x = element_blank()
  ) 



```



```{r}





mov_immov <-dyn_adr  %>%  group_by(caste_groups,dyn_cum_2_text) %>% summarise(mov_sum = sum(total_movable_assets_totals), immov_sum = sum(total_immovable_assets_totals), sum_mov_immov = sum(mov_sum + immov_sum), mov_prop = mov_sum/sum_mov_immov, immov_prop = immov_sum /sum_mov_immov) %>% select(caste_groups, dyn_cum_2_text, mov_prop, immov_prop)
# 
mov_immov_m <- mov_immov %>% melt(id = 1:2, measure = 3:4)

# 
# 
ggplot(mov_immov_m , aes(x =factor(dyn_cum_2_text) , y=  value, fill = variable))+
  geom_bar(  position="stack", stat="identity")+
  facet_grid( ~ caste_groups)+
  theme_minimal()+
  theme(plot.margin = unit(c(.5,.5,.5,.5), "cm"))+
  #scale_x_discrete(c("Family","Non-family"))+
  scale_fill_manual (labels = c("Movable", "Immovable"),
    values = c("#468189", "#9DBEBB"))+
  labs(title = "Break-up of assets among caste groups", x = "", y = "Proportion") +
  theme(legend.position = "top",
        plot.title = element_text(hjust = 0.5, size = 18, family = "serif"),
        plot.subtitle = element_text(hjust = 0.5, size = 15,
                                     margin = margin(t = 0, r = 0, b = 20, l = 0)),
        text = element_text(color = "gray20",family = "serif"),
        legend.title = element_blank(),
        legend.text = element_text(size = 12),
        axis.text = element_text(face = "italic", size = 10),
        axis.text.x = element_text(angle = 90,
          hjust = 1, vjust = 0),
        axis.title.x = element_text(vjust = -1, size = 1),
        axis.title.y = element_text(vjust = 2, size =14),
        axis.ticks.y = element_blank(),
        axis.line= element_line(color = "gray40", size = .5),
        axis.line.y = element_blank(),
        panel.grid.major = element_line(color = "gray50", size = .5),
        panel.grid.minor = element_blank(),
        panel.grid.major.x = element_blank()
        
  )



```





## Crime {.tabset}

### Political expereince

```{r}


dyn_adr %>%  group_by( dyn_cum_2_text,fam_exp_cum_cat)%>% summarise(mean_sc= mean(serious_crime), mean_nsc=mean(non_serious_crime)) %>% filter (fam_exp_cum_cat != "[0,1)")%>% melt(id = 1:2, measure = 3:4) %>% 
  ggplot(aes(fam_exp_cum_cat, value, fill = variable))+
  geom_bar(stat= "identity", position ="dodge")+
  facet_grid(~dyn_cum_2_text)+
  theme_minimal()+
   scale_fill_manual (labels = c("Serious crime", "Non-Serious Crime"),
    values = c("#468189", "#9DBEBB"))+
    scale_x_discrete(labels = c("1-5","6-10","11-20", "21+"))+
    labs(title = "Average criminality wrt politcal experience",  x = "Politial experience \n (years)", y = "Number of criminal cases \n (mean)") +
    theme(plot.margin = unit(c(.5,.5,.5,.5), "cm"))+
  
    theme(legend.position = "top",
        plot.background = element_blank(),
        plot.title = element_text(family = "serif",hjust = 0.5, size = 20), 
        plot.subtitle = element_text(hjust = 0.5, size = 15,
                                     margin = margin(t = 0, r = 0, b = 20, l = 0)),
        text = element_text(color = "gray20",family = "serif"),
        axis.text.x = element_text( 
                                   hjust = .5, vjust = 0),
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        axis.text = element_text(face = "italic", size = 10),
        axis.title = element_text(vjust = -1, size = 15),        
        axis.ticks = element_blank(),
        panel.grid.major = element_line(color = "gray50", size = .5),
        panel.grid.minor = element_blank(),
        panel.grid.major.x = element_blank()
  ) 
  





```




### Family

```{r serious crime}


dyn_crime<- dyn_adr_uniq_ind %>% group_by(dyn_cum_2) %>% summarise(mean_sc = mean(serious_crime,trim =.1),mean_nsc = mean(non_serious_crime, trim=.1)) 


dyn_crime_m <- melt(dyn_crime, measure = 2:3, id ="dyn_cum_2")


  ggplot(dyn_crime_m, aes(factor(variable), value, fill = factor(dyn_cum_2)))+
  geom_bar(stat= "identity", position = "dodge")+
    theme_minimal()+
    scale_fill_manual (labels = c("Non - Family", "Family"),
    values = c("#468189", "#9DBEBB"))+
    scale_x_discrete(labels=(c("Serious crime", "Non-serious crime")))+
    labs(title = "Break-up of crime among families and non-families",  x = "", y = "Trimmed mean") +
    theme(plot.margin = unit(c(.5,.5,.5,.5), "cm"))+
  
    theme(legend.position = "top",
        plot.title = element_text(hjust = 0.5, size = 18, family = "serif"), 
        plot.subtitle = element_text(hjust = 0.5, size = 15,
                                     margin = margin(t = 0, r = 0, b = 20, l = 0)),
        text = element_text(color = "gray20"),
        legend.title = element_blank(),
        legend.text = element_text(size = 10),
        axis.text = element_text(face = "italic", size = 13),
        axis.text.x = element_text( 
                                   hjust = .5, vjust = 0),
        axis.title.x = element_text(vjust = -1, size = 14),
        axis.title.y = element_text(vjust = 2, size =14),
        axis.ticks.y = element_blank(),
        axis.line= element_line(color = "gray40", size = .5),
        axis.line.y = element_blank(),
        panel.grid.major = element_line(color = "gray50", size = .5),
        panel.grid.minor = element_blank(),
        panel.grid.major.x = element_blank()
          
  )

  



```

### stable v/s rising {.tabset}


#### AE

```{r}

dyn_adr %>% filter(election_type=="AE" & dyn_cum_2 ==1) %>% group_by(success_cat) %>% summarise(obs = n(),mean_sc= mean(serious_crime), mean_nsc=mean(non_serious_crime))%>% kable(digits = 2) %>% kable_styling(full_width = F)

```

#### GE

```{r}
dyn_adr %>% filter(election_type=="GE" & dyn_cum_2 ==1) %>% group_by(success_cat) %>% summarise(obs = n(),mean_sc= mean(serious_crime), mean_nsc=mean(non_serious_crime))%>% kable(digits = 2) %>% kable_styling(full_width = F)
```


### caste v/s crime


```{r}


dyn_adr %>%  group_by(caste_groups)%>% summarise(mean_sc= mean(serious_crime), mean_nsc=mean(non_serious_crime)) %>%  melt(id = "caste_groups", measure = 2:3) %>% 
  ggplot(aes(reorder(caste_groups,-value), value, fill = variable))+
  geom_bar(stat= "identity", position ="dodge")+
  theme_minimal()+
   scale_fill_manual (labels = c("Serious crime", "Non-Serious Crime"),
    values = c("#468189", "#9DBEBB"))+
    labs(title = "Average criminality wrt caste groups",  x = "", y = "Number of criminal cases \n (mean)") +
    theme(plot.margin = unit(c(.5,.5,.5,.5), "cm"))+
  
    theme(legend.position = "top",
        plot.background = element_blank(),
        plot.title = element_text(family = "serif",hjust = 0.5, size = 20), 
        plot.subtitle = element_text(hjust = 0.5, size = 15,
                                     margin = margin(t = 0, r = 0, b = 20, l = 0)),
        text = element_text(color = "gray20",family = "serif"),
        axis.text.x = element_text( 
                                   hjust = .5, vjust = 0),
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        axis.text = element_text(face = "italic", size = 10),
        axis.title = element_text(vjust = -1, size = 15),        
        axis.ticks = element_blank(),
        panel.grid.major = element_line(color = "gray50", size = .5),
        panel.grid.minor = element_blank(),
        panel.grid.major.x = element_blank()
  ) 
  


```








## Perfromance {.tabset}


```{r config}

dyn_adr_ge_w <- dyn_adr %>% filter(year %in% c(2009,2014,2019) & position ==1)

dyn_adr_ge_w_uniq <- dyn_adr_ge_w%>% group_by(fam_rel_id_uniq) %>% filter(year == max(year)) %>% distinct(family_id, .keep_all = TRUE)


```



### Summary

```{r}



dyn_pp <- dyn_adr_ge_w %>% 
  filter(year != 2019) %>% 
  group_by(fam_rel_id_uniq) %>% 
  mutate(ind_mean_deb = mean(debates, na.rm = TRUE), ind_mean_att = mean(attendance,na.rm = TRUE), ind_mean_qs = mean(questions_asked, na.rm = TRUE))%>% ungroup()%>%group_by(dyn_cum_2) %>% 
summarise(mean_debate = mean(ind_mean_deb, na.rm = TRUE,trim =.1), mean_attendance = mean(ind_mean_att, na.rm = TRUE,trim =.1), mean_questions = mean(ind_mean_qs, na.rm = TRUE,trim =.1)) %>% select(2:4)


fam <- data.frame( c("Non-family", "Family"))


cbind(fam, dyn_pp) %>% kable(caption = "Average performance of MPs in the Parliament \n (trimmed mean)",col.names = c ("Entity","Debates partcipated", "Proprtion of the sessions \n attended", "Questions asked"),digits = 2)%>% kable_styling(bootstrap_options = "striped")





```

### Stable v/s rising

```{r}
dyn_adr_ge_w%>% filter(election_type=="GE" & dyn_cum_2 ==1) %>% group_by(success_cat) %>% summarise(obs = n(), attendance = mean(attendance, na.rm = TRUE), debates = mean(debates, na.rm = TRUE), questions = mean(questions_asked, na.rm =TRUE)) %>% kable(digits =2) %>% kable_styling(full_width = F)
```




### Attendance




```{r}





ggplot(dyn_adr_ge_w %>% filter(year != 2019), aes(factor(dyn_cum_2), attendance, group = factor(dyn_cum_2)))+
  geom_boxplot( outlier.shape = NA)+
  #coord_cartesian(ylim = ylim1)+
  facet_grid(~ year)+
  scale_x_discrete(labels=(c("Non Family","Family")))+
  scale_y_continuous(labels = scales:: percent_format(accuracy = 1))+
  theme_minimal()+
  labs(title = "Parliament attendance wrt family type  ",subtitle = " General elections: 2009 - 2019", x = "", y = "Attendance" )+
  theme(plot.background = element_blank(),
        plot.title = element_text(family = "serif",hjust = 0.5, size = 20), 
        plot.subtitle = element_text(hjust = 0.5, size = 15,
                                     margin = margin(t = 0, r = 0, b = 20, l = 0)),
        text = element_text(color = "gray20"),
        axis.text.x = element_text( 
                                   hjust = .5, vjust = 0),
        legend.title = element_blank(),
        legend.text = element_text(size = 1),
        axis.text = element_text(face = "italic", size = 10),
        axis.title = element_text(vjust = -1, size = 13),        
        axis.ticks = element_blank(),
        panel.grid.major.x = element_blank(),
        
  ) 

  

```




### Debates


```{r}


dyn_adr_ge_w_p <- dyn_adr_ge_w %>% filter(year != 2019) 
ylim1 = boxplot.stats(dyn_adr_ge_w_p$debates)$stats[c(1, 5)]

ggplot(dyn_adr_ge_w_p , aes(factor(dyn_cum_2), debates, group = factor(dyn_cum_2)))+
  geom_boxplot( outlier.shape = NA)+
  coord_cartesian(ylim = ylim1*1.05)+
  facet_grid(~ year)+
  scale_x_discrete(labels=(c("Non Family","Family")))+
  theme_minimal()+
  labs(title = "Parliament: debate partcipation wrt family type  ",subtitle = " General elections: 2009 - 2019", x = "", y = "Number of debates" )+
  theme(plot.background = element_blank(),
        plot.title = element_text(family = "serif",hjust = 0.5, size = 20), 
        plot.subtitle = element_text(hjust = 0.5, size = 15,
                                     margin = margin(t = 0, r = 0, b = 20, l = 0)),
        text = element_text(color = "gray20"),
        axis.text.x = element_text( 
                                   hjust = .5, vjust = 0),
        legend.title = element_blank(),
        legend.text = element_text(size = 1),
        axis.text = element_text(face = "italic", size = 10),
        axis.title = element_text(vjust = -1, size = 13),        
        axis.ticks = element_blank(),
        panel.grid.major.x = element_blank(),
        
  )



```





### Questions



```{r}

ylim1 = boxplot.stats(dyn_adr_ge_w_p$questions_asked)$stats[c(1, 5)]


ggplot(dyn_adr_ge_w_p  %>% filter( questions_asked != "NA"), aes(factor(dyn_cum_2), questions_asked, group = factor(dyn_cum_2)))+
  geom_boxplot( outlier.shape = NA)+
  coord_cartesian(ylim = ylim1*1.05)+
  facet_grid(~ year)+
  scale_x_discrete(labels=(c("Non Family","Family")))+
  theme_minimal()+
  labs(title = "Parliament: questions asked wrt family type  ",subtitle = " General elections: 2009 - 2019", x = "", y = "Number of questions" )+
  theme(plot.background = element_blank(),
        plot.title = element_text(family = "serif",hjust = 0.5, size = 20), 
        plot.subtitle = element_text(hjust = 0.5, size = 15,
                                     margin = margin(t = 0, r = 0, b = 20, l = 0)),
        text = element_text(color = "gray20"),
        axis.text.x = element_text( 
                                   hjust = .5, vjust = 0),
        legend.title = element_blank(),
        legend.text = element_text(size = 1),
        axis.text = element_text(face = "italic", size = 10),
        axis.title = element_text(vjust = -1, size = 13),        
        axis.ticks = element_blank(),
        panel.grid.major.x = element_blank(),
        
  )


```






